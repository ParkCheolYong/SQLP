--온라인 트랜잭션이 없는 야간에 대량 데이터를 일괄 INSERT 하는 배치프로그램 성능 향상
--TARGET_T 테이블에 PK인덱스만 존재

--[변경전 SQL]
DELETE FROM TARGET_T;

COMMIT;

ALTER SESSION ENABLE PARALLEL DML;

INSERT /*+ APPEND */ INTO TARGET_T T1
SELECT /*+ FULL(T2) PARALLEL(T2 4) */ *
  FROM SOURCE_T T2;
  
COMMIT;

ALTER SESSION DISABLE PARALLEL DML;


--[변경후 SQL]
TRUNCATE FROM TARGET_T; --DELETE는 REDO로그와 UNDO로그를 생성하면서 레코드 단위로 삭제하므로 느림
                        --TRUNCATE는 딕셔너리 상에서 익스텐트만 반환하므로 빠름 

COMMIT;

ALTER TABLE TARGET_T MODIFY CONSTRAINT TARGET_T_PK DISABLE DROP INDEX; --제약조건을 해제하고 인덱스를 UNUSABLE상태로 변경하면 성능 향상

ALTER SESSION ENABLE PARALLEL DML;

ALTER TABLE TARGET_T NOLOGGING; -- REDO로깅 생략

INSERT /*+ PARALLEL(T1 4) */ INTO TARGET_T T1
SELECT /*+ FULL(T2) PARALLEL(T2 4) */ *
  FROM SOURCE_T T2;
  
COMMIT;

ALTER TABLE TARGET_T MODIFY CONSTRAINT TARGET_T_PK ENABLE NOVALIDATE;

ALTER TABLE TARGET_T LOGGING;

ALTER SESSION DISABLE PARALLEL DML;  